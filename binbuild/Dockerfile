FROM plitex/meteord:base
MAINTAINER Miguel Mejias

ARG NODE_VERSION
ENV NODE_VERSION ${NODE_VERSION:-4.6.2}

ONBUILD ARG NPM_PRIVATE_REGISTRY_URL
ONBUILD ARG NPM_PRIVATE_REGISTRY_SCOPE
ONBUILD ARG NPM_PRIVATE_REGISTRY_TOKEN
ONBUILD ENV NPM_PRIVATE_REGISTRY_URL $NPM_PRIVATE_REGISTRY_URL
ONBUILD ENV NPM_PRIVATE_REGISTRY_SCOPE $NPM_PRIVATE_REGISTRY_SCOPE
ONBUILD ENV NPM_PRIVATE_REGISTRY_TOKEN $NPM_PRIVATE_REGISTRY_TOKEN

COPY scripts/install_binbuild_tools.sh $METEORD_DIR/install_binbuild_tools.sh
COPY scripts/rebuild_npm_modules.sh $METEORD_DIR/rebuild_npm_modules.sh

RUN bash $METEORD_DIR/lib/install_node.sh
RUN bash $METEORD_DIR/install_binbuild_tools.sh

ONBUILD ENV NPM_PRIVATE_REGISTRY_TOKEN ""
